_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[22],{"21Jo":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/direct-TODO",function(){return n("dZZI")}])},dZZI:function(e,t,n){"use strict";n.r(t);var c=n("Ff2n"),o=n("rePB"),r=n("KQm4"),s=n("nKUr"),i=n("q1tI"),a=n("8Kt/"),l=n.n(a),u=n("jifJ"),f=n.n(u),j=n("HlzF"),d=n("lBUC"),b=n("nOHt"),m=n("qwht");function h(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var c=n.call(e,t||"default");if("object"!==typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,c)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=new j.Howl({src:["/audio/gesture-192.mp3"],volume:.5}),p=function(e){var t=e.label,n=e.checked,o=e.onChange,r=Object(c.a)(e,["label","checked","onChange"]);return Object(s.jsx)("div",g(g({className:"checkbox"},r),{},{children:Object(s.jsxs)("label",{children:[Object(s.jsx)("input",{type:"checkbox",value:t,checked:n,onChange:o}),"\xa0",t]})}))},x=function(e,t,n){return t>e.length-1?e:e.substring(0,t)+n+e.substring(t+1)},y=function(e){return e.startsWith(" ")&&(e=x(e,0,"\xa0")),e.endsWith(" ")&&(e=x(e,e.length-1,"\xa0")),e},S="-".repeat((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}).length),N=/(?<!\S)((?:ftp|http|https):\/\/(?:\w+:{0,1}\w*@)?(?:\S+)(?::[0-9]+)?(?:\/|\/(?:[\w#!:.?+=&%@!-/]))?)/,w=function(e){for(var t=e.split(N),n=1;n<t.length;n+=2)t[n]=Object(s.jsx)("a",{href:"".concat(t[n]),target:"_blank",rel:"noreferrer",children:t[n]},"link"+n);return t},k=Object(i.memo)((function(e){var t=e.message,n=t.name,c=t.trip,o=t.color,r=t.content,a=t.time,l=t.active,u=e.followUp,f=e.cozyMode,j=Object(i.useState)(S),d=j[0],b=j[1];Object(i.useEffect)((function(){b(new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))}),[a]);var m=Object(i.useState)([]),h=m[0],v=m[1];Object(i.useEffect)((function(){v(r.replace(/^\s+|\s+$/g,"").replace(/ {2}/g," \xa0").split("\n").map(y).map(w))}),[r]);var g=n&&n.length>0?n:c,O=Object(s.jsxs)("span",{className:"tooltip",style:{color:o},children:[Object(s.jsx)("span",{className:"name",style:{background:l?"".concat(o,"55"):"inherit"},children:g}),Object(s.jsx)("span",{className:"tooltiptext",children:c})]}),p=Object(s.jsxs)("span",{className:"mobile-trip",children:["[",c,"] "]});return Object(s.jsx)(E,{cozyMode:f,followUp:u,timeString:d,tooltip:O,mobileTrip:p,lines:h})})),E=function(e){var t=e.cozyMode,n=e.followUp,c=e.timeString,o=e.tooltip,r=e.mobileTrip,i=e.lines;return Object(s.jsxs)("div",{className:"message"+(t?" style-mobile":" style-irc")+(n?" followUp":""),children:[Object(s.jsxs)("div",{className:"meta",children:[Object(s.jsx)("span",{className:"time",children:c}),"\xa0",o,"\xa0",r]}),Object(s.jsx)("div",{className:"content",children:i.map((function(e,t){return Object(s.jsxs)("div",{className:"text",children:[e,Object(s.jsx)("br",{})]},t)}))})]})},I=function(e){var t=e.socket,n=Object(i.useState)(""),c=n[0],o=n[1];return Object(s.jsx)("textarea",{className:"messageInput preventToggle",placeholder:"Say something",value:c,onChange:function(e){e.target.value.length>512&&(e.target.value=e.target.value.slice(0,512)),0===c.length?t.emit("begin message",{content:e.target.value}):0===e.target.value.length?t.emit("remove message"):t.emit("change message",{content:e.target.value}),o(e.target.value)},onKeyDown:function(e){if(13===e.keyCode&&!1===e.shiftKey){if(e.preventDefault(),Object(d.a)(c))return;o(""),t.emit("send message")}}})},T=function(e){var t=e.connections,n=e.connClass,c=e.saveSecret,o=e.setSaveSecret,r=e.cozyMode,i=e.setCozyMode;return Object(s.jsxs)("div",{className:"connectionsBox ".concat(n),children:[Object(s.jsx)("div",{className:"connectionsTitle",children:"Settings"}),Object(s.jsx)("div",{className:"settingsBox",children:Object(s.jsxs)("div",{className:"settings",children:[Object(s.jsx)(p,{className:"keepinfo",label:"Don't reset user info",checked:c,onChange:function(){return o(!c)}}),Object(s.jsx)(p,{className:"cozymode",label:"Non-IRC view",checked:r,onChange:function(){return i(!r)}})]})}),Object(s.jsx)("div",{className:"connectionsTitle",children:"Connections"}),Object(s.jsx)("div",{className:"connections",children:Object.keys(t).map((function(e,n){var c=t[e];return Object(s.jsxs)("div",{className:"connection",children:[Object(s.jsx)("div",{className:"connectionName",style:{color:c.color},children:c.name}),Object(s.jsx)("div",{className:"connectionTrip",children:c.trip})]},n)}))})]})};t.default=function(){var e=Object(i.useState)("/favicon.ico"),t=e[0],n=e[1],a=Object(i.useState)(null),u=a[0],j=a[1],v=Object(i.useState)(null),p=v[0],x=v[1],y=Object(i.useState)({}),S=y[0],N=y[1],w=Object(i.useState)(""),E=w[0],C=w[1],P=Object(i.useState)(!1),_=P[0],z=P[1],D=Object(i.useState)(!1),M=D[0],U=D[1],B=Object(i.useState)(null),H=B[0],F=B[1],J=Object(i.useState)(!1),K=J[0],L=J[1],R=Object(i.useState)({}),Z=R[0],X=R[1],q=Object(i.useState)([]),A=q[0],W=q[1],$=Object(i.useState)(""),G=$[0],Q=$[1],Y=function(e,t,n){return e.off(t).on(t,n)};Object(i.useEffect)((function(){return j(f()("https://chat.soma.cx",{path:"/socket.io.rt/"})),"true"===localStorage.getItem("cozyMode")&&L(!0),window.addEventListener("focus",(function(){return n("/favicon.ico")})),function(){window.removeEventListener("focus",(function(){return n("/favicon.ico")}))}}),[]);var V=Object(b.useRouter)();Object(i.useEffect)((function(){"/direct"===V.pathname&&document.documentElement.style.setProperty("height","100%")}),[V]),Object(i.useEffect)((function(){K?localStorage.setItem("cozyMode","true"):localStorage.removeItem("cozyMode")}),[K]),Object(i.useEffect)((function(){if(null!==u)return Y(u,"connected",(function(e){var t=e.id,n=e.keys,c=e.chat;if(console.log("You connected with connection ID =",t),x(t),W(n),X(c),"true"==localStorage.getItem("saveSecret")){z(!0);var o=localStorage.getItem("secret");null!==o&&(C(o),u.emit("secret blur",{secret:o}),console.log("SENDING",o))}})),Y(u,"client alive?",(function(){u.emit("client alive")})),Y(u,"user connected",(function(e){var t=e.id,n=e.connections;console.log("User connected:",t),N(n)})),Y(u,"user left",(function(e){var t=e.id,n=e.connections;console.log("User left:",t),N(n)})),Y(u,"change secret",(function(e){F(e)})),Y(u,"secret blur",(function(e){e.user;var t=e.connections;N(t)})),Y(u,"begin message",(function(e){W((function(t){return[].concat(Object(r.a)(t),[e.time])})),X((function(t){return g(g({},t),{},Object(o.a)({},e.time,e))}))})),Y(u,"change message",(function(e){X((function(t){return g(g({},t),{},Object(o.a)({},e.time,e))}))})),Y(u,"remove message",(function(e){var t=e.time;W((function(e){var n=e.indexOf(t);if(-1===n)return e;var c=Object(r.a)(e);return c.splice(n,1),c})),X((function(e){e[t];return Object(c.a)(e,[t].map(h))}))})),Y(u,"wipe old messages",(function(e){var t=e.chat,n=e.keys;W(n),X(t)})),function(){u.emit("leave")}}),[u]),Object(i.useEffect)((function(){null!==u&&Y(u,"send message",(function(e){X((function(t){return g(g({},t),{},Object(o.a)({},e.time,e))})),document.hasFocus()||n("/favicon-notif.ico"),p in S&&e.content.includes("@"+S[p].trip)&&(O.play(),console.log("".concat(e.trip," tagged you (").concat(S[p].trip,").")))}))}),[u,p,S]),Object(i.useEffect)((function(){null!==u&&null!==E&&u.emit("change secret",{secret:E})}),[u,E]),Object(i.useEffect)((function(){_&&(U(!0),localStorage.setItem("saveSecret","true"),localStorage.setItem("secret",E),0===E.length&&localStorage.removeItem("secret"))}),[_,E]),Object(i.useEffect)((function(){M&&!_&&(localStorage.removeItem("saveSecret"),localStorage.removeItem("secret"))}),[_,M]);var ee=Object(i.useRef)(null);return Object(i.useEffect)((function(){var e=ee.current;if(null!==e){var t,n=e.scrollHeight-((t=e.scrollTop)<0?-t:t)-e.offsetHeight;if(e.scrollTop<0&&e.scrollTop>-50)e.scrollTo({left:0,top:1,behavior:"smooth"}),e.scrollTo({left:0,top:0,behavior:"smooth"});else if(n<50){var c=e.scrollHeight+e.offsetHeight+500;e.scrollTo({left:0,top:c+1,behavior:"smooth"}),e.scrollTo({left:0,top:c,behavior:"smooth"})}}}),[A,Z]),null!==u&&!1!==u.connected&&p in S&&null!==H&&null!==_?Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)(l.a,{children:[Object(s.jsx)("title",{children:"somachat"}),Object(s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1"},"direct"),Object(s.jsx)("link",{id:"favicon",rel:"icon",type:"image/png",href:t})]}),Object(s.jsx)("div",{className:"chat-main",children:Object(s.jsxs)("div",{className:"chat fadeInChat",children:[Object(s.jsxs)("div",{className:"header",children:[Object(s.jsxs)("div",{className:"txt",children:[Object(s.jsx)(m.b,{href:"/home",target:"_blank",children:"soma.cx"})," ","| hyper-real-time chat |"," ",Object(s.jsx)(m.b,{href:"/about",target:"_blank",children:"about/donate"})]}),Object(s.jsx)("div",{className:"generator",children:Object(s.jsxs)("div",{className:"namesave",children:[Object(s.jsxs)("div",{className:"nametrip",children:[Object(s.jsx)("span",{style:{color:H.color},children:H.name})," ",H.trip]}),Object(s.jsx)("div",{className:"checkboxAndInput",children:Object(s.jsx)("input",{className:"secretInput preventToggle",placeholder:"name#secret",onChange:function(e){Object(d.b)(e,C)},onBlur:function(){u.emit("secret blur",{secret:E})},value:E})})]})}),Object(s.jsx)("div",{className:"connButton",onClick:function(){Q(""===G?"connOpen":"")},children:"\ud83d\udce1"})]}),Object(s.jsxs)("div",{className:"theFlex",children:[Object(s.jsx)("div",{className:"messages",ref:ee,children:Object(r.a)(A).reverse().map((function(e,t,n){var c=Z[e];if(void 0!==c){var o=n[t+1],r=void 0!==o?Z[o]:void 0,i=void 0!==r?r.trip:void 0,a=void 0!==i&&i===c.trip;return void 0!==r&&c.time-r.time>6e5&&(a=!1),Object(s.jsx)(k,{message:c,followUp:a,cozyMode:K},"".concat(p,":").concat(c.time))}}))}),Object(s.jsx)(T,{connClass:G,connections:S,saveSecret:_,setSaveSecret:z,cozyMode:K,setCozyMode:L})]}),Object(s.jsx)(I,{socket:u})]})})]}):Object(s.jsx)("div",{className:"chat-main",children:Object(s.jsx)("div",{className:"loading",children:"Chat is loading..."})})}},lBUC:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return s}));var c=n("ODXe"),o=(n("T5bk"),n("lPiR"),n("562I"),function(e){return""===e.replace(/^\s+/,"").replace(/\s+$/,"")}),r=function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t),t&=t;for(var c="#",o=0;o<3;o++){var r=t>>8*o&255;c+=("00"+(r|=80).toString(16)).substr(-2)}return c},s=function(e,t){var n=e.target.value;if("#"===n[n.length-1]&&!n.slice(0,n.length-1).includes("#")&&n.length-1>12){var o=n.split("");o.splice(12,o.length-12),n=o.join("")+"#"}if(n.includes("#")){var r=n.split("#");if(Object(c.a)(r,1)[0].length>12)return}t(n)}}},[["21Jo",0,1,6,2,3,5,7]]]);