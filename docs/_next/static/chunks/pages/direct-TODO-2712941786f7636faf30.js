_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[22],{"21Jo":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/direct-TODO",function(){return n("dZZI")}])},dZZI:function(e,t,n){"use strict";n.r(t);var c=n("Ff2n"),o=n("rePB"),r=n("KQm4"),s=n("q1tI"),i=n("8Kt/"),a=n.n(i),l=n("jifJ"),u=n.n(l),f=n("HlzF"),j=n("lBUC"),d=n("nOHt"),b=n("qwht"),m=n("nKUr"),h=["label","checked","onChange"];function v(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var c=n.call(e,t||"default");if("object"!==typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,c)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=new f.Howl({src:["/audio/gesture-192.mp3"],volume:.5}),x=function(e){var t=e.label,n=e.checked,o=e.onChange,r=Object(c.a)(e,h);return Object(m.jsx)("div",O(O({className:"checkbox"},r),{},{children:Object(m.jsxs)("label",{children:[Object(m.jsx)("input",{type:"checkbox",value:t,checked:n,onChange:o}),"\xa0",t]})}))},y=function(e,t,n){return t>e.length-1?e:e.substring(0,t)+n+e.substring(t+1)},S=function(e){return e.startsWith(" ")&&(e=y(e,0,"\xa0")),e.endsWith(" ")&&(e=y(e,e.length-1,"\xa0")),e},N="-".repeat((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}).length),w=/(?<!\S)((?:ftp|http|https):\/\/(?:\w+:{0,1}\w*@)?(?:\S+)(?::[0-9]+)?(?:\/|\/(?:[\w#!:.?+=&%@!-/]))?)/,k=function(e){for(var t=e.split(w),n=1;n<t.length;n+=2)t[n]=Object(m.jsx)("a",{href:"".concat(t[n]),target:"_blank",rel:"noreferrer",children:t[n]},"link"+n);return t},E=Object(s.memo)((function(e){var t=e.message,n=t.name,c=t.trip,o=t.color,r=t.content,i=t.time,a=t.active,l=e.followUp,u=e.cozyMode,f=Object(s.useState)(N),j=f[0],d=f[1];Object(s.useEffect)((function(){d(new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))}),[i]);var b=Object(s.useState)([]),h=b[0],v=b[1];Object(s.useEffect)((function(){v(r.replace(/^\s+|\s+$/g,"").replace(/ {2}/g," \xa0").split("\n").map(S).map(k))}),[r]);var g=n&&n.length>0?n:c,O=Object(m.jsxs)("span",{className:"tooltip",style:{color:o},children:[Object(m.jsx)("span",{className:"name",style:{background:a?"".concat(o,"55"):"inherit"},children:g}),Object(m.jsx)("span",{className:"tooltiptext",children:c})]}),p=Object(m.jsxs)("span",{className:"mobile-trip",children:["[",c,"] "]});return Object(m.jsx)(I,{cozyMode:u,followUp:l,timeString:j,tooltip:O,mobileTrip:p,lines:h})})),I=function(e){var t=e.cozyMode,n=e.followUp,c=e.timeString,o=e.tooltip,r=e.mobileTrip,s=e.lines;return Object(m.jsxs)("div",{className:"message"+(t?" style-mobile":" style-irc")+(n?" followUp":""),children:[Object(m.jsxs)("div",{className:"meta",children:[Object(m.jsx)("span",{className:"time",children:c}),"\xa0",o,"\xa0",r]}),Object(m.jsx)("div",{className:"content",children:s.map((function(e,t){return Object(m.jsxs)("div",{className:"text",children:[e,Object(m.jsx)("br",{})]},t)}))})]})},T=function(e){var t=e.socket,n=Object(s.useState)(""),c=n[0],o=n[1];return Object(m.jsx)("textarea",{className:"messageInput preventToggle",placeholder:"Say something",value:c,onChange:function(e){e.target.value.length>512&&(e.target.value=e.target.value.slice(0,512)),0===c.length?t.emit("begin message",{content:e.target.value}):0===e.target.value.length?t.emit("remove message"):t.emit("change message",{content:e.target.value}),o(e.target.value)},onKeyDown:function(e){if(13===e.keyCode&&!1===e.shiftKey){if(e.preventDefault(),Object(j.a)(c))return;o(""),t.emit("send message")}}})},C=function(e){var t=e.connections,n=e.connClass,c=e.saveSecret,o=e.setSaveSecret,r=e.cozyMode,s=e.setCozyMode;return Object(m.jsxs)("div",{className:"connectionsBox ".concat(n),children:[Object(m.jsx)("div",{className:"connectionsTitle",children:"Settings"}),Object(m.jsx)("div",{className:"settingsBox",children:Object(m.jsxs)("div",{className:"settings",children:[Object(m.jsx)(x,{className:"keepinfo",label:"Don't reset user info",checked:c,onChange:function(){return o(!c)}}),Object(m.jsx)(x,{className:"cozymode",label:"Non-IRC view",checked:r,onChange:function(){return s(!r)}})]})}),Object(m.jsx)("div",{className:"connectionsTitle",children:"Connections"}),Object(m.jsx)("div",{className:"connections",children:Object.keys(t).map((function(e,n){var c=t[e];return Object(m.jsxs)("div",{className:"connection",children:[Object(m.jsx)("div",{className:"connectionName",style:{color:c.color},children:c.name}),Object(m.jsx)("div",{className:"connectionTrip",children:c.trip})]},n)}))})]})};t.default=function(){var e=Object(s.useState)("/favicon.ico"),t=e[0],n=e[1],i=Object(s.useState)(null),l=i[0],f=i[1],h=Object(s.useState)(null),g=h[0],x=h[1],y=Object(s.useState)({}),S=y[0],N=y[1],w=Object(s.useState)(""),k=w[0],I=w[1],P=Object(s.useState)(!1),_=P[0],z=P[1],D=Object(s.useState)(!1),M=D[0],U=D[1],B=Object(s.useState)(null),H=B[0],F=B[1],J=Object(s.useState)(!1),K=J[0],L=J[1],R=Object(s.useState)({}),Z=R[0],X=R[1],q=Object(s.useState)([]),A=q[0],W=q[1],$=Object(s.useState)(""),G=$[0],Q=$[1],Y=function(e,t,n){return e.off(t).on(t,n)};Object(s.useEffect)((function(){return f(u()("https://chat.soma.cx",{path:"/socket.io.rt/"})),"true"===localStorage.getItem("cozyMode")&&L(!0),window.addEventListener("focus",(function(){return n("/favicon.ico")})),function(){window.removeEventListener("focus",(function(){return n("/favicon.ico")}))}}),[]);var V=Object(d.useRouter)();Object(s.useEffect)((function(){"/direct"===V.pathname&&document.documentElement.style.setProperty("height","100%")}),[V]),Object(s.useEffect)((function(){K?localStorage.setItem("cozyMode","true"):localStorage.removeItem("cozyMode")}),[K]),Object(s.useEffect)((function(){if(null!==l)return Y(l,"connected",(function(e){var t=e.id,n=e.keys,c=e.chat;if(console.log("You connected with connection ID =",t),x(t),W(n),X(c),"true"==localStorage.getItem("saveSecret")){z(!0);var o=localStorage.getItem("secret");null!==o&&(I(o),l.emit("secret blur",{secret:o}),console.log("SENDING",o))}})),Y(l,"client alive?",(function(){l.emit("client alive")})),Y(l,"user connected",(function(e){var t=e.id,n=e.connections;console.log("User connected:",t),N(n)})),Y(l,"user left",(function(e){var t=e.id,n=e.connections;console.log("User left:",t),N(n)})),Y(l,"change secret",(function(e){F(e)})),Y(l,"secret blur",(function(e){e.user;var t=e.connections;N(t)})),Y(l,"begin message",(function(e){W((function(t){return[].concat(Object(r.a)(t),[e.time])})),X((function(t){return O(O({},t),{},Object(o.a)({},e.time,e))}))})),Y(l,"change message",(function(e){X((function(t){return O(O({},t),{},Object(o.a)({},e.time,e))}))})),Y(l,"remove message",(function(e){var t=e.time;W((function(e){var n=e.indexOf(t);if(-1===n)return e;var c=Object(r.a)(e);return c.splice(n,1),c})),X((function(e){e[t];return Object(c.a)(e,[t].map(v))}))})),Y(l,"wipe old messages",(function(e){var t=e.chat,n=e.keys;W(n),X(t)})),function(){l.emit("leave")}}),[l]),Object(s.useEffect)((function(){null!==l&&Y(l,"send message",(function(e){X((function(t){return O(O({},t),{},Object(o.a)({},e.time,e))})),document.hasFocus()||n("/favicon-notif.ico"),g in S&&e.content.includes("@"+S[g].trip)&&(p.play(),console.log("".concat(e.trip," tagged you (").concat(S[g].trip,").")))}))}),[l,g,S]),Object(s.useEffect)((function(){null!==l&&null!==k&&l.emit("change secret",{secret:k})}),[l,k]),Object(s.useEffect)((function(){_&&(U(!0),localStorage.setItem("saveSecret","true"),localStorage.setItem("secret",k),0===k.length&&localStorage.removeItem("secret"))}),[_,k]),Object(s.useEffect)((function(){M&&!_&&(localStorage.removeItem("saveSecret"),localStorage.removeItem("secret"))}),[_,M]);var ee=Object(s.useRef)(null);return Object(s.useEffect)((function(){var e=ee.current;if(null!==e){var t,n=e.scrollHeight-((t=e.scrollTop)<0?-t:t)-e.offsetHeight;if(e.scrollTop<0&&e.scrollTop>-50)e.scrollTo({left:0,top:1,behavior:"smooth"}),e.scrollTo({left:0,top:0,behavior:"smooth"});else if(n<50){var c=e.scrollHeight+e.offsetHeight+500;e.scrollTo({left:0,top:c+1,behavior:"smooth"}),e.scrollTo({left:0,top:c,behavior:"smooth"})}}}),[A,Z]),null!==l&&!1!==l.connected&&g in S&&null!==H&&null!==_?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)(a.a,{children:[Object(m.jsx)("title",{children:"somachat"}),Object(m.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1"},"direct"),Object(m.jsx)("link",{id:"favicon",rel:"icon",type:"image/png",href:t})]}),Object(m.jsx)("div",{className:"chat-main",children:Object(m.jsxs)("div",{className:"chat fadeInChat",children:[Object(m.jsxs)("div",{className:"header",children:[Object(m.jsxs)("div",{className:"txt",children:[Object(m.jsx)(b.b,{href:"/home",target:"_blank",children:"soma.cx"})," ","| hyper-real-time chat |"," ",Object(m.jsx)(b.b,{href:"/about",target:"_blank",children:"about/donate"})]}),Object(m.jsx)("div",{className:"generator",children:Object(m.jsxs)("div",{className:"namesave",children:[Object(m.jsxs)("div",{className:"nametrip",children:[Object(m.jsx)("span",{style:{color:H.color},children:H.name})," ",H.trip]}),Object(m.jsx)("div",{className:"checkboxAndInput",children:Object(m.jsx)("input",{className:"secretInput preventToggle",placeholder:"name#secret",onChange:function(e){Object(j.b)(e,I)},onBlur:function(){l.emit("secret blur",{secret:k})},value:k})})]})}),Object(m.jsx)("div",{className:"connButton",onClick:function(){Q(""===G?"connOpen":"")},children:"\ud83d\udce1"})]}),Object(m.jsxs)("div",{className:"theFlex",children:[Object(m.jsx)("div",{className:"messages",ref:ee,children:Object(r.a)(A).reverse().map((function(e,t,n){var c=Z[e];if(void 0!==c){var o=n[t+1],r=void 0!==o?Z[o]:void 0,s=void 0!==r?r.trip:void 0,i=void 0!==s&&s===c.trip;return void 0!==r&&c.time-r.time>6e5&&(i=!1),Object(m.jsx)(E,{message:c,followUp:i,cozyMode:K},"".concat(g,":").concat(c.time))}}))}),Object(m.jsx)(C,{connClass:G,connections:S,saveSecret:_,setSaveSecret:z,cozyMode:K,setCozyMode:L})]}),Object(m.jsx)(T,{socket:l})]})})]}):Object(m.jsx)("div",{className:"chat-main",children:Object(m.jsx)("div",{className:"loading",children:"Chat is loading..."})})}},lBUC:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return s}));var c=n("ODXe"),o=(n("T5bk"),n("lPiR"),n("562I"),function(e){return""===e.replace(/^\s+/,"").replace(/\s+$/,"")}),r=function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t),t&=t;for(var c="#",o=0;o<3;o++){var r=t>>8*o&255;c+=("00"+(r|=80).toString(16)).substr(-2)}return c},s=function(e,t){var n=e.target.value;if("#"===n[n.length-1]&&!n.slice(0,n.length-1).includes("#")&&n.length-1>12){var o=n.split("");o.splice(12,o.length-12),n=o.join("")+"#"}if(n.includes("#")){var r=n.split("#");if(Object(c.a)(r,1)[0].length>12)return}t(n)}}},[["21Jo",0,1,6,2,3,5,7]]]);