(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[670],{7456:function(e,t,n){"use strict";n.r(t);var c=n(4925),o=n(4942),r=n(3433),s=n(7294),i=n(9008),a=n(8594),l=n(1766),u=n(2779),f=n(1163),m=n(1205),d=n(5893),h=["label","checked","onChange"];function v(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var c=n.call(e,t||"default");if("object"!==typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,c)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=new l.Howl({src:["/audio/gesture-192.mp3"],volume:.5}),j="/favicon.ico",b=function(e){var t=e.label,n=e.checked,o=e.onChange,r=(0,c.Z)(e,h);return(0,d.jsx)("div",p(p({className:"checkbox"},r),{},{children:(0,d.jsxs)("label",{children:[(0,d.jsx)("input",{type:"checkbox",value:t,checked:n,onChange:o}),"\xa0",t]})}))},y=function(e,t,n){return t>e.length-1?e:e.substring(0,t)+n+e.substring(t+1)},S=function(e){return e.startsWith(" ")&&(e=y(e,0,"\xa0")),e.endsWith(" ")&&(e=y(e,e.length-1,"\xa0")),e},N="-".repeat((new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}).length),w=/(?<!\S)((?:ftp|http|https):\/\/(?:\w+:{0,1}\w*@)?(?:\S+)(?::[0-9]+)?(?:\/|\/(?:[\w#!:.?+=&%@!-/]))?)/,k=function(e){for(var t=e.split(w),n=1;n<t.length;n+=2)t[n]=(0,d.jsx)("a",{href:"".concat(t[n]),target:"_blank",rel:"noreferrer",children:t[n]},"link"+n);return t},O=(0,s.memo)((function(e){var t=e.message,n=t.name,c=t.trip,o=t.color,r=t.content,i=t.time,a=t.active,l=e.followUp,u=e.cozyMode,f=(0,s.useState)(N),m=f[0],h=f[1];(0,s.useEffect)((function(){h(new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))}),[i]);var v=(0,s.useState)([]),g=v[0],p=v[1];(0,s.useEffect)((function(){p(r.replace(/^\s+|\s+$/g,"").replace(/ {2}/g," \xa0").split("\n").map(S).map(k))}),[r]);var x=n&&n.length>0?n:c,j=(0,d.jsxs)("span",{className:"tooltip",style:{color:o},children:[(0,d.jsx)("span",{className:"name",style:{background:a?"".concat(o,"55"):"inherit"},children:x}),(0,d.jsx)("span",{className:"tooltiptext",children:c})]}),b=(0,d.jsxs)("span",{className:"mobile-trip",children:["[",c,"] "]});return(0,d.jsx)(E,{cozyMode:u,followUp:l,timeString:m,tooltip:j,mobileTrip:b,lines:g})})),E=function(e){var t=e.cozyMode,n=e.followUp,c=e.timeString,o=e.tooltip,r=e.mobileTrip,s=e.lines;return(0,d.jsxs)("div",{className:"message"+(t?" style-mobile":" style-irc")+(n?" followUp":""),children:[(0,d.jsxs)("div",{className:"meta",children:[(0,d.jsx)("span",{className:"time",children:c}),"\xa0",o,"\xa0",r]}),(0,d.jsx)("div",{className:"content",children:s.map((function(e,t){return(0,d.jsxs)("div",{className:"text",children:[e,(0,d.jsx)("br",{})]},t)}))})]})},C=function(e){var t=e.socket,n=(0,s.useState)(""),c=n[0],o=n[1];return(0,d.jsx)("textarea",{className:"messageInput preventToggle",placeholder:"Say something",value:c,onChange:function(e){e.target.value.length>512&&(e.target.value=e.target.value.slice(0,512)),0===c.length?t.emit("begin message",{content:e.target.value}):0===e.target.value.length?t.emit("remove message"):t.emit("change message",{content:e.target.value}),o(e.target.value)},onKeyDown:function(e){if(13===e.keyCode&&!1===e.shiftKey){if(e.preventDefault(),(0,u.xb)(c))return;o(""),t.emit("send message")}}})},T=function(e){var t=e.connections,n=e.connClass,c=e.saveSecret,o=e.setSaveSecret,r=e.cozyMode,s=e.setCozyMode;return(0,d.jsxs)("div",{className:"connectionsBox ".concat(n),children:[(0,d.jsx)("div",{className:"connectionsTitle",children:"Settings"}),(0,d.jsx)("div",{className:"settingsBox",children:(0,d.jsxs)("div",{className:"settings",children:[(0,d.jsx)(b,{className:"keepinfo",label:"Don't reset user info",checked:c,onChange:function(){return o(!c)}}),(0,d.jsx)(b,{className:"cozymode",label:"Non-IRC view",checked:r,onChange:function(){return s(!r)}})]})}),(0,d.jsx)("div",{className:"connectionsTitle",children:"Connections"}),(0,d.jsx)("div",{className:"connections",children:Object.keys(t).map((function(e,n){var c=t[e];return(0,d.jsxs)("div",{className:"connection",children:[(0,d.jsx)("div",{className:"connectionName",style:{color:c.color},children:c.name}),(0,d.jsx)("div",{className:"connectionTrip",children:c.trip})]},n)}))})]})};t.default=function(){var e=(0,s.useState)(j),t=e[0],n=e[1],l=(0,s.useState)(null),h=l[0],g=l[1],b=(0,s.useState)(null),y=b[0],S=b[1],N=(0,s.useState)({}),w=N[0],k=N[1],E=(0,s.useState)(""),I=E[0],_=E[1],P=(0,s.useState)(!1),z=P[0],D=P[1],M=(0,s.useState)(!1),Z=M[0],U=M[1],H=(0,s.useState)(null),B=H[0],L=H[1],F=(0,s.useState)(!1),R=F[0],A=F[1],K=(0,s.useState)({}),W=K[0],X=K[1],$=(0,s.useState)([]),G=$[0],Y=$[1],q=(0,s.useState)(""),J=q[0],Q=q[1],V=function(e,t,n){return e.off(t).on(t,n)};(0,s.useEffect)((function(){return g((0,a.Z)("https://chat.soma.cx",{path:"/socket.io.rt/"})),"true"===localStorage.getItem("cozyMode")&&A(!0),window.addEventListener("focus",(function(){return n(j)})),function(){window.removeEventListener("focus",(function(){return n(j)}))}}),[]);var ee=(0,f.useRouter)();(0,s.useEffect)((function(){"/direct"===ee.pathname&&document.documentElement.style.setProperty("height","100%")}),[ee]),(0,s.useEffect)((function(){R?localStorage.setItem("cozyMode","true"):localStorage.removeItem("cozyMode")}),[R]),(0,s.useEffect)((function(){if(null!==h)return V(h,"connected",(function(e){var t=e.id,n=e.keys,c=e.chat;if(console.log("You connected with connection ID =",t),S(t),Y(n),X(c),"true"==localStorage.getItem("saveSecret")){D(!0);var o=localStorage.getItem("secret");null!==o&&(_(o),h.emit("secret blur",{secret:o}),console.log("SENDING",o))}})),V(h,"client alive?",(function(){h.emit("client alive")})),V(h,"user connected",(function(e){var t=e.id,n=e.connections;console.log("User connected:",t),k(n)})),V(h,"user left",(function(e){var t=e.id,n=e.connections;console.log("User left:",t),k(n)})),V(h,"change secret",(function(e){L(e)})),V(h,"secret blur",(function(e){e.user;var t=e.connections;k(t)})),V(h,"begin message",(function(e){Y((function(t){return[].concat((0,r.Z)(t),[e.time])})),X((function(t){return p(p({},t),{},(0,o.Z)({},e.time,e))}))})),V(h,"change message",(function(e){X((function(t){return p(p({},t),{},(0,o.Z)({},e.time,e))}))})),V(h,"remove message",(function(e){var t=e.time;Y((function(e){var n=e.indexOf(t);if(-1===n)return e;var c=(0,r.Z)(e);return c.splice(n,1),c})),X((function(e){e[t];return(0,c.Z)(e,[t].map(v))}))})),V(h,"wipe old messages",(function(e){var t=e.chat,n=e.keys;Y(n),X(t)})),function(){h.emit("leave")}}),[h]),(0,s.useEffect)((function(){null!==h&&V(h,"send message",(function(e){X((function(t){return p(p({},t),{},(0,o.Z)({},e.time,e))})),document.hasFocus()||n("/favicon-notif.ico"),y in w&&e.content.includes("@"+w[y].trip)&&(x.play(),console.log("".concat(e.trip," tagged you (").concat(w[y].trip,").")))}))}),[h,y,w]),(0,s.useEffect)((function(){null!==h&&null!==I&&h.emit("change secret",{secret:I})}),[h,I]),(0,s.useEffect)((function(){z&&(U(!0),localStorage.setItem("saveSecret","true"),localStorage.setItem("secret",I),0===I.length&&localStorage.removeItem("secret"))}),[z,I]),(0,s.useEffect)((function(){Z&&!z&&(localStorage.removeItem("saveSecret"),localStorage.removeItem("secret"))}),[z,Z]);var te=(0,s.useRef)(null);return(0,s.useEffect)((function(){var e=te.current;if(null!==e){var t,n=e.scrollHeight-((t=e.scrollTop)<0?-t:t)-e.offsetHeight;if(e.scrollTop<0&&e.scrollTop>-50)e.scrollTo({left:0,top:1,behavior:"smooth"}),e.scrollTo({left:0,top:0,behavior:"smooth"});else if(n<50){var c=e.scrollHeight+e.offsetHeight+500;e.scrollTo({left:0,top:c+1,behavior:"smooth"}),e.scrollTo({left:0,top:c,behavior:"smooth"})}}}),[G,W]),null!==h&&!1!==h.connected&&y in w&&null!==B&&null!==z?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(i.default,{children:[(0,d.jsx)("title",{children:"somachat"}),(0,d.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1"},"direct"),(0,d.jsx)("link",{id:"favicon",rel:"icon",type:"image/png",href:t})]}),(0,d.jsx)("div",{className:"chat-main",children:(0,d.jsxs)("div",{className:"chat fadeInChat",children:[(0,d.jsxs)("div",{className:"header",children:[(0,d.jsxs)("div",{className:"txt",children:[(0,d.jsx)(m._,{href:"/home",target:"_blank",children:"soma.cx"})," ","| hyper-real-time chat |"," ",(0,d.jsx)(m._,{href:"/about",target:"_blank",children:"about/donate"})]}),(0,d.jsx)("div",{className:"generator",children:(0,d.jsxs)("div",{className:"namesave",children:[(0,d.jsxs)("div",{className:"nametrip",children:[(0,d.jsx)("span",{style:{color:B.color},children:B.name})," ",B.trip]}),(0,d.jsx)("div",{className:"checkboxAndInput",children:(0,d.jsx)("input",{className:"secretInput preventToggle",placeholder:"name#secret",onChange:function(e){(0,u.ki)(e,_)},onBlur:function(){h.emit("secret blur",{secret:I})},value:I})})]})}),(0,d.jsx)("div",{className:"connButton",onClick:function(){Q(""===J?"connOpen":"")},children:"\ud83d\udce1"})]}),(0,d.jsxs)("div",{className:"theFlex",children:[(0,d.jsx)("div",{className:"messages",ref:te,children:(0,r.Z)(G).reverse().map((function(e,t,n){var c=W[e];if(void 0!==c){var o=n[t+1],r=void 0!==o?W[o]:void 0,s=void 0!==r?r.trip:void 0,i=void 0!==s&&s===c.trip;return void 0!==r&&c.time-r.time>6e5&&(i=!1),(0,d.jsx)(O,{message:c,followUp:i,cozyMode:R},"".concat(y,":").concat(c.time))}}))}),(0,d.jsx)(T,{connClass:J,connections:w,saveSecret:z,setSaveSecret:D,cozyMode:R,setCozyMode:A})]}),(0,d.jsx)(C,{socket:h})]})})]}):(0,d.jsx)("div",{className:"chat-main",children:(0,d.jsx)("div",{className:"loading",children:"Chat is loading..."})})}},2779:function(e,t,n){"use strict";n.d(t,{xb:function(){return o},NC:function(){return r},ki:function(){return s}});var c=n(9439),o=(n(2153),n(8134),function(e){return""===e.replace(/^\s+/,"").replace(/\s+$/,"")}),r=function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t),t&=t;for(var c="#",o=0;o<3;o++){var r=t>>8*o&255;c+=("00"+(r|=80).toString(16)).substr(-2)}return c},s=function(e,t){var n=e.target.value;if("#"===n[n.length-1]&&!n.slice(0,n.length-1).includes("#")&&n.length-1>12){var o=n.split("");o.splice(12,o.length-12),n=o.join("")+"#"}if(n.includes("#")){var r=n.split("#");if((0,c.Z)(r,1)[0].length>12)return}t(n)}},9390:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/direct-TODO",function(){return n(7456)}])},2480:function(){}},function(e){e.O(0,[871,96,706,774,888,179],(function(){return t=9390,e(e.s=t);var t}));var t=e.O();_N_E=t}]);